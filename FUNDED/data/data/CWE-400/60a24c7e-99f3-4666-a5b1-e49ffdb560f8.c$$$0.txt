-----label-----
1
-----code-----
static int agent_call(struct ast_channel *ast, const char *dest, int timeout)
{
	struct agent_pvt *p = ast_channel_tech_pvt(ast);
	int res = -1;
	int newstate=0;
	struct ast_channel *chan;

	ast_mutex_lock(&p->lock);
	p->acknowledged = 0;

	if (p->pending) {
		ast_log(LOG_DEBUG, "Pretending to dial on pending agent\n");
		ast_mutex_unlock(&p->lock);
		ast_setstate(ast, AST_STATE_DIALING);
		return 0;
	}

	if (!p->chan) {
		ast_log(LOG_DEBUG, "Agent disconnected while we were connecting the call\n");
		ast_mutex_unlock(&p->lock);
		return res;
	}
	ast_verb(3, "agent_call, call to agent '%s' call on '%s'\n", p->agent, ast_channel_name(p->chan));
	ast_debug(3, "Playing beep, lang '%s'\n", ast_channel_language(p->chan));

	chan = p->chan;
	ast_mutex_unlock(&p->lock);

	res = ast_streamfile(chan, beep, ast_channel_language(chan));
	ast_debug(3, "Played beep, result '%d'\n", res);
	if (!res) {
		res = ast_waitstream(chan, "");
		ast_debug(3, "Waited for stream, result '%d'\n", res);
	}

	ast_mutex_lock(&p->lock);
	if (!p->chan) {
		/* chan went away while we were streaming, this shouldn't be possible */
		res = -1;
	}

	if (!res) {
		struct ast_format tmpfmt;
		res = ast_set_read_format_from_cap(p->chan, ast_channel_nativeformats(p->chan));
		ast_debug(3, "Set read format, result '%d'\n", res);
		if (res)
			ast_log(LOG_WARNING, "Unable to set read format to %s\n", ast_getformatname(&tmpfmt));
	} else {
		/* Agent hung-up */
		p->chan = NULL;
		ast_devstate_changed(AST_DEVICE_UNAVAILABLE, "Agent/%s", p->agent);
	}

	if (!res) {
		struct ast_format tmpfmt;
		res = ast_set_write_format_from_cap(p->chan, ast_channel_nativeformats(p->chan));
		ast_debug(3, "Set write format, result '%d'\n", res);
		if (res)
			ast_log(LOG_WARNING, "Unable to set write format to %s\n", ast_getformatname(&tmpfmt));
	}
	if(!res) {
		/* Call is immediately up, or might need ack */
		if (p->ackcall) {
			newstate = AST_STATE_RINGING;
		} else {
			newstate = AST_STATE_UP;
			if (recordagentcalls)
				agent_start_monitoring(ast, 0);
			p->acknowledged = 1;
		}
		res = 0;
	}
	CLEANUP(ast, p);
	ast_mutex_unlock(&p->lock);
	if (newstate)
		ast_setstate(ast, newstate);
	return res;
}
-----children-----
1,2
1,3
1,4
3,4
3,5
3,6
3,7
5,6
5,7
6,7
8,9
8,10
11,12
11,13
13,14
13,15
16,17
16,18
18,19
20,21
20,22
20,23
20,24
20,25
20,26
20,27
20,28
20,29
20,30
20,31
20,32
20,33
20,34
20,35
20,36
20,37
20,38
20,39
20,40
20,41
20,42
20,43
20,44
21,22
22,23
22,24
23,24
25,26
25,27
25,28
28,29
29,30
29,31
30,31
32,33
34,35
35,36
35,37
37,38
37,39
39,40
40,41
42,43
43,44
43,45
45,46
45,47
47,48
49,50
50,51
50,52
51,52
53,54
53,55
56,57
57,58
57,59
58,59
60,61
61,62
61,63
62,63
65,66
66,67
66,68
67,68
67,69
68,69
72,73
72,74
73,74
73,75
74,75
77,78
77,79
77,80
77,81
78,79
79,80
79,81
79,82
80,81
82,83
85,86
86,87
86,88
87,88
89,90
90,91
90,92
91,92
94,95
95,96
95,97
95,98
96,97
98,99
100,101
102,103
104,105
104,106
105,106
106,107
106,108
107,108
110,111
110,112
110,113
111,112
112,113
112,114
112,115
113,114
115,116
118,119
119,120
119,121
120,121
122,123
123,124
123,125
124,125
127,128
128,129
130,131
131,132
131,133
131,134
131,135
131,136
132,133
136,137
136,138
137,138
140,141
140,142
141,142
143,144
143,145
144,145
147,148
148,149
148,150
148,151
148,152
149,150
153,154
153,155
154,155
156,157
156,158
157,158
160,161
161,162
161,163
162,163
164,165
164,166
165,166
168,169
169,170
169,171
170,171
172,173
173,174
173,175
174,175
177,178
178,179
178,180
179,180
181,182
181,183
181,184
181,185
182,183
184,185
186,187
188,189
188,190
189,190
191,192
193,194
194,195
194,196
194,197
194,198
195,196
199,200
201,202
201,203
202,203
203,204
205,206
205,207
206,207
207,208
207,209
208,209
210,211
210,212
210,213
211,212
213,214
216,217
217,218
217,219
217,220
217,221
218,219
222,223
224,225
225,226
225,227
226,227
228,229
229,230
229,231
230,231
233,234
233,235
234,235
235,236
235,237
236,237
239,240
240,241
241,242
241,243
242,243
244,245
246,247
246,248
246,249
247,248
248,249
250,251
250,252
250,253
250,254
251,252
252,253
252,254
253,254
255,256
257,258
258,259
258,260
259,260
261,262
261,263
261,264
262,263
264,265
264,266
265,266
268,269
268,270
269,270
271,272
271,273
272,273
275,276
276,277
276,278
276,279
276,280
277,278
281,282
283,284
283,285
284,285
286,287
287,288
287,289
287,290
287,291
288,289
290,291
293,294
293,295
294,295
296,297
297,298
299,300
299,301
300,301
301,302
301,303
302,303
302,304
303,304
306,307
308,309
309,310
309,311
309,312
309,313
310,311
312,313
315,316
315,317
316,317
319,320
319,321
320,321
321,322
323,324
323,325
323,326
323,327
324,325
325,326
325,327
326,327
328,329
330,331
331,332
331,333
332,333
334,335
334,336
334,337
335,336
337,338
337,339
338,339
341,342
341,343
342,343
344,345
344,346
345,346
348,349
349,350
349,351
349,352
349,353
350,351
354,355
356,357
356,358
357,358
359,360
360,361
360,362
360,363
360,364
361,362
363,364
366,367
366,368
367,368
369,370
370,371
372,373
372,374
373,374
374,375
376,377
376,378
377,378
377,379
377,380
378,379
378,380
379,380
382,383
383,384
384,385
384,386
385,386
387,388
389,390
389,391
389,392
390,391
391,392
391,393
392,393
394,395
396,397
396,398
397,398
399,400
400,401
400,402
400,403
401,402
403,404
406,407
407,408
407,409
408,409
408,410
409,410
413,414
414,415
414,416
415,416
418,419
419,420
419,421
419,422
420,421
422,423
424,425
426,427
427,428
427,429
428,429
430,431
431,432
431,433
432,433
435,436
435,437
436,437
438,439
439,440
439,441
439,442
440,441
442,443
444,445
446,447
447,448
-----nextToken-----
2,4,7,9,10,12,14,15,17,19,24,26,27,31,33,36,38,41,44,46,48,52,54,55,59,63,64,69,70,71,75,76,81,83,84,88,92,93,97,99,101,103,108,109,114,116,117,121,125,126,129,133,134,135,138,139,142,145,146,150,151,152,155,158,159,163,166,167,171,175,176,180,183,185,187,190,192,196,197,198,200,204,209,212,214,215,219,220,221,223,227,231,232,237,238,243,245,249,254,256,260,263,266,267,270,273,274,278,279,280,282,285,289,291,292,295,298,304,305,307,311,313,314,317,318,322,327,329,333,336,339,340,343,346,347,351,352,353,355,358,362,364,365,368,371,375,380,381,386,388,393,395,398,402,404,405,410,411,412,416,417,421,423,425,429,433,434,437,441,443,445,448
-----computeFrom-----
66,67
66,68
161,162
161,163
178,179
178,180
207,208
207,209
241,242
241,243
258,259
258,260
301,302
301,303
331,332
331,333
384,385
384,386
391,392
391,393
407,408
407,409
414,415
414,416
-----guardedBy-----
-----guardedByNegation-----
-----lastLexicalUse-----
-----jump-----
-----attribute-----
FunctionDefinition;SimpleDeclSpecifier;FunctionDeclarator;Name;ParameterDeclaration;ElaboratedTypeSpecifier;Name;Declarator;Pointer;Name;ParameterDeclaration;SimpleDeclSpecifier;Declarator;Pointer;Name;ParameterDeclaration;SimpleDeclSpecifier;Declarator;Name;CompoundStatement;DeclarationStatement;SimpleDeclaration;ElaboratedTypeSpecifier;Name;Declarator;Pointer;Name;EqualsInitializer;FunctionCallExpression;IdExpression;Name;IdExpression;Name;DeclarationStatement;SimpleDeclaration;SimpleDeclSpecifier;Declarator;Name;EqualsInitializer;UnaryExpression;LiteralExpression;DeclarationStatement;SimpleDeclaration;SimpleDeclSpecifier;Declarator;Name;EqualsInitializer;LiteralExpression;DeclarationStatement;SimpleDeclaration;ElaboratedTypeSpecifier;Name;Declarator;Pointer;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;UnaryExpression;FieldReference;IdExpression;Name;Name;ExpressionStatement;BinaryExpression;FieldReference;IdExpression;Name;Name;LiteralExpression;IfStatement;FieldReference;IdExpression;Name;Name;CompoundStatement;ExpressionStatement;FunctionCallExpression;IdExpression;Name;IdExpression;Name;LiteralExpression;ExpressionStatement;FunctionCallExpression;IdExpression;Name;UnaryExpression;FieldReference;IdExpression;Name;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;IdExpression;Name;IdExpression;Name;ReturnStatement;LiteralExpression;IfStatement;UnaryExpression;FieldReference;IdExpression;Name;Name;CompoundStatement;ExpressionStatement;FunctionCallExpression;IdExpression;Name;IdExpression;Name;LiteralExpression;ExpressionStatement;FunctionCallExpression;IdExpression;Name;UnaryExpression;FieldReference;IdExpression;Name;Name;ReturnStatement;IdExpression;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;LiteralExpression;LiteralExpression;FieldReference;IdExpression;Name;Name;FunctionCallExpression;IdExpression;Name;FieldReference;IdExpression;Name;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;LiteralExpression;LiteralExpression;FunctionCallExpression;IdExpression;Name;FieldReference;IdExpression;Name;Name;ExpressionStatement;BinaryExpression;IdExpression;Name;FieldReference;IdExpression;Name;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;UnaryExpression;FieldReference;IdExpression;Name;Name;ExpressionStatement;BinaryExpression;IdExpression;Name;FunctionCallExpression;IdExpression;Name;IdExpression;Name;IdExpression;Name;FunctionCallExpression;IdExpression;Name;IdExpression;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;LiteralExpression;LiteralExpression;IdExpression;Name;IfStatement;UnaryExpression;IdExpression;Name;CompoundStatement;ExpressionStatement;BinaryExpression;IdExpression;Name;FunctionCallExpression;IdExpression;Name;IdExpression;Name;LiteralExpression;ExpressionStatement;FunctionCallExpression;IdExpression;Name;LiteralExpression;LiteralExpression;IdExpression;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;UnaryExpression;FieldReference;IdExpression;Name;Name;IfStatement;UnaryExpression;FieldReference;IdExpression;Name;Name;CompoundStatement;ExpressionStatement;BinaryExpression;IdExpression;Name;UnaryExpression;LiteralExpression;IfStatement;UnaryExpression;IdExpression;Name;CompoundStatement;DeclarationStatement;SimpleDeclaration;ElaboratedTypeSpecifier;Name;Declarator;Name;ExpressionStatement;BinaryExpression;IdExpression;Name;FunctionCallExpression;IdExpression;Name;FieldReference;IdExpression;Name;Name;FunctionCallExpression;IdExpression;Name;FieldReference;IdExpression;Name;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;LiteralExpression;LiteralExpression;IdExpression;Name;IfStatement;IdExpression;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;IdExpression;Name;LiteralExpression;FunctionCallExpression;IdExpression;Name;UnaryExpression;IdExpression;Name;CompoundStatement;ExpressionStatement;BinaryExpression;FieldReference;IdExpression;Name;Name;IdExpression;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;IdExpression;Name;LiteralExpression;FieldReference;IdExpression;Name;Name;IfStatement;UnaryExpression;IdExpression;Name;CompoundStatement;DeclarationStatement;SimpleDeclaration;ElaboratedTypeSpecifier;Name;Declarator;Name;ExpressionStatement;BinaryExpression;IdExpression;Name;FunctionCallExpression;IdExpression;Name;FieldReference;IdExpression;Name;Name;FunctionCallExpression;IdExpression;Name;FieldReference;IdExpression;Name;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;LiteralExpression;LiteralExpression;IdExpression;Name;IfStatement;IdExpression;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;IdExpression;Name;LiteralExpression;FunctionCallExpression;IdExpression;Name;UnaryExpression;IdExpression;Name;IfStatement;UnaryExpression;IdExpression;Name;CompoundStatement;IfStatement;FieldReference;IdExpression;Name;Name;CompoundStatement;ExpressionStatement;BinaryExpression;IdExpression;Name;IdExpression;Name;CompoundStatement;ExpressionStatement;BinaryExpression;IdExpression;Name;IdExpression;Name;IfStatement;IdExpression;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;IdExpression;Name;LiteralExpression;ExpressionStatement;BinaryExpression;FieldReference;IdExpression;Name;Name;LiteralExpression;ExpressionStatement;BinaryExpression;IdExpression;Name;LiteralExpression;ExpressionStatement;FunctionCallExpression;IdExpression;Name;IdExpression;Name;IdExpression;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;UnaryExpression;FieldReference;IdExpression;Name;Name;IfStatement;IdExpression;Name;ExpressionStatement;FunctionCallExpression;IdExpression;Name;IdExpression;Name;IdExpression;Name;ReturnStatement;IdExpression;Name;
-----ast_node-----
static int agent_call(struct ast_channel *ast, const char *dest, int timeout){	struct agent_pvt *p = ast_channel_tech_pvt(ast);	int res = -1;	int newstate=0;	struct ast_channel *chan;	ast_mutex_lock(&p->lock);	p->acknowledged = 0;	if (p->pending) {		ast_log(LOG_DEBUG, "Pretending to dial on pending agent\n");		ast_mutex_unlock(&p->lock);		ast_setstate(ast, AST_STATE_DIALING);		return 0;	}	if (!p->chan) {		ast_log(LOG_DEBUG, "Agent disconnected while we were connecting the call\n");		ast_mutex_unlock(&p->lock);		return res;	}	ast_verb(3, "agent_call, call to agent '%s' call on '%s'\n", p->agent, ast_channel_name(p->chan));	ast_debug(3, "Playing beep, lang '%s'\n", ast_channel_language(p->chan));	chan = p->chan;	ast_mutex_unlock(&p->lock);	res = ast_streamfile(chan, beep, ast_channel_language(chan));	ast_debug(3, "Played beep, result '%d'\n", res);	if (!res) {		res = ast_waitstream(chan, "");		ast_debug(3, "Waited for stream, result '%d'\n", res);	}	ast_mutex_lock(&p->lock);	if (!p->chan) {		/* chan went away while we were streaming, this shouldn't be possible */		res = -1;	}	if (!res) {		struct ast_format tmpfmt;		res = ast_set_read_format_from_cap(p->chan, ast_channel_nativeformats(p->chan));		ast_debug(3, "Set read format, result '%d'\n", res);		if (res)			ast_log(LOG_WARNING, "Unable to set read format to %s\n", ast_getformatname(&tmpfmt));	} else {		/* Agent hung-up */		p->chan = NULL;		ast_devstate_changed(AST_DEVICE_UNAVAILABLE, "Agent/%s", p->agent);	}	if (!res) {		struct ast_format tmpfmt;		res = ast_set_write_format_from_cap(p->chan, ast_channel_nativeformats(p->chan));		ast_debug(3, "Set write format, result '%d'\n", res);		if (res)			ast_log(LOG_WARNING, "Unable to set write format to %s\n", ast_getformatname(&tmpfmt));	}	if(!res) {		/* Call is immediately up, or might need ack */		if (p->ackcall) {			newstate = AST_STATE_RINGING;		} else {			newstate = AST_STATE_UP;			if (recordagentcalls)				agent_start_monitoring(ast, 0);			p->acknowledged = 1;		}		res = 0;	}	CLEANUP(ast, p);	ast_mutex_unlock(&p->lock);	if (newstate)		ast_setstate(ast, newstate);	return res;}
static int
agent_call(struct ast_channel *ast, const char *dest, int timeout)
agent_call
struct ast_channel *ast
struct ast_channel
ast_channel
*ast
*
ast
const char *dest
const char
*dest
*
dest
int timeout
int
timeout
timeout
{	struct agent_pvt *p = ast_channel_tech_pvt(ast);	int res = -1;	int newstate=0;	struct ast_channel *chan;	ast_mutex_lock(&p->lock);	p->acknowledged = 0;	if (p->pending) {		ast_log(LOG_DEBUG, "Pretending to dial on pending agent\n");		ast_mutex_unlock(&p->lock);		ast_setstate(ast, AST_STATE_DIALING);		return 0;	}	if (!p->chan) {		ast_log(LOG_DEBUG, "Agent disconnected while we were connecting the call\n");		ast_mutex_unlock(&p->lock);		return res;	}	ast_verb(3, "agent_call, call to agent '%s' call on '%s'\n", p->agent, ast_channel_name(p->chan));	ast_debug(3, "Playing beep, lang '%s'\n", ast_channel_language(p->chan));	chan = p->chan;	ast_mutex_unlock(&p->lock);	res = ast_streamfile(chan, beep, ast_channel_language(chan));	ast_debug(3, "Played beep, result '%d'\n", res);	if (!res) {		res = ast_waitstream(chan, "");		ast_debug(3, "Waited for stream, result '%d'\n", res);	}	ast_mutex_lock(&p->lock);	if (!p->chan) {		/* chan went away while we were streaming, this shouldn't be possible */		res = -1;	}	if (!res) {		struct ast_format tmpfmt;		res = ast_set_read_format_from_cap(p->chan, ast_channel_nativeformats(p->chan));		ast_debug(3, "Set read format, result '%d'\n", res);		if (res)			ast_log(LOG_WARNING, "Unable to set read format to %s\n", ast_getformatname(&tmpfmt));	} else {		/* Agent hung-up */		p->chan = NULL;		ast_devstate_changed(AST_DEVICE_UNAVAILABLE, "Agent/%s", p->agent);	}	if (!res) {		struct ast_format tmpfmt;		res = ast_set_write_format_from_cap(p->chan, ast_channel_nativeformats(p->chan));		ast_debug(3, "Set write format, result '%d'\n", res);		if (res)			ast_log(LOG_WARNING, "Unable to set write format to %s\n", ast_getformatname(&tmpfmt));	}	if(!res) {		/* Call is immediately up, or might need ack */		if (p->ackcall) {			newstate = AST_STATE_RINGING;		} else {			newstate = AST_STATE_UP;			if (recordagentcalls)				agent_start_monitoring(ast, 0);			p->acknowledged = 1;		}		res = 0;	}	CLEANUP(ast, p);	ast_mutex_unlock(&p->lock);	if (newstate)		ast_setstate(ast, newstate);	return res;}
struct agent_pvt *p = ast_channel_tech_pvt(ast);
struct agent_pvt *p = ast_channel_tech_pvt(ast);
struct agent_pvt
agent_pvt
*p = ast_channel_tech_pvt(ast)
*
p
= ast_channel_tech_pvt(ast)
ast_channel_tech_pvt(ast)
ast_channel_tech_pvt
ast_channel_tech_pvt
ast
ast
int res = -1;
int res = -1;
int
res = -1
res
= -1
-1
1
int newstate=0;
int newstate=0;
int
newstate=0
newstate
=0
0
struct ast_channel *chan;
struct ast_channel *chan;
struct ast_channel
ast_channel
*chan
*
chan
ast_mutex_lock(&p->lock);
ast_mutex_lock(&p->lock)
ast_mutex_lock
ast_mutex_lock
&p->lock
p->lock
p
p
lock
p->acknowledged = 0;
p->acknowledged = 0
p->acknowledged
p
p
acknowledged
0
if (p->pending) {		ast_log(LOG_DEBUG, "Pretending to dial on pending agent\n");		ast_mutex_unlock(&p->lock);		ast_setstate(ast, AST_STATE_DIALING);		return 0;	}
p->pending
p
p
pending
{		ast_log(LOG_DEBUG, "Pretending to dial on pending agent\n");		ast_mutex_unlock(&p->lock);		ast_setstate(ast, AST_STATE_DIALING);		return 0;	}
ast_log(LOG_DEBUG, "Pretending to dial on pending agent\n");
ast_log(LOG_DEBUG, "Pretending to dial on pending agent\n")
ast_log
ast_log
LOG_DEBUG
LOG_DEBUG
"Pretending to dial on pending agent\n"
ast_mutex_unlock(&p->lock);
ast_mutex_unlock(&p->lock)
ast_mutex_unlock
ast_mutex_unlock
&p->lock
p->lock
p
p
lock
ast_setstate(ast, AST_STATE_DIALING);
ast_setstate(ast, AST_STATE_DIALING)
ast_setstate
ast_setstate
ast
ast
AST_STATE_DIALING
AST_STATE_DIALING
return 0;
0
if (!p->chan) {		ast_log(LOG_DEBUG, "Agent disconnected while we were connecting the call\n");		ast_mutex_unlock(&p->lock);		return res;	}
!p->chan
p->chan
p
p
chan
{		ast_log(LOG_DEBUG, "Agent disconnected while we were connecting the call\n");		ast_mutex_unlock(&p->lock);		return res;	}
ast_log(LOG_DEBUG, "Agent disconnected while we were connecting the call\n");
ast_log(LOG_DEBUG, "Agent disconnected while we were connecting the call\n")
ast_log
ast_log
LOG_DEBUG
LOG_DEBUG
"Agent disconnected while we were connecting the call\n"
ast_mutex_unlock(&p->lock);
ast_mutex_unlock(&p->lock)
ast_mutex_unlock
ast_mutex_unlock
&p->lock
p->lock
p
p
lock
return res;
res
res
ast_verb(3, "agent_call, call to agent '%s' call on '%s'\n", p->agent, ast_channel_name(p->chan));
ast_verb(3, "agent_call, call to agent '%s' call on '%s'\n", p->agent, ast_channel_name(p->chan))
ast_verb
ast_verb
3
"agent_call, call to agent '%s' call on '%s'\n"
p->agent
p
p
agent
ast_channel_name(p->chan)
ast_channel_name
ast_channel_name
p->chan
p
p
chan
ast_debug(3, "Playing beep, lang '%s'\n", ast_channel_language(p->chan));
ast_debug(3, "Playing beep, lang '%s'\n", ast_channel_language(p->chan))
ast_debug
ast_debug
3
"Playing beep, lang '%s'\n"
ast_channel_language(p->chan)
ast_channel_language
ast_channel_language
p->chan
p
p
chan
chan = p->chan;
chan = p->chan
chan
chan
p->chan
p
p
chan
ast_mutex_unlock(&p->lock);
ast_mutex_unlock(&p->lock)
ast_mutex_unlock
ast_mutex_unlock
&p->lock
p->lock
p
p
lock
res = ast_streamfile(chan, beep, ast_channel_language(chan));
res = ast_streamfile(chan, beep, ast_channel_language(chan))
res
res
ast_streamfile(chan, beep, ast_channel_language(chan))
ast_streamfile
ast_streamfile
chan
chan
beep
beep
ast_channel_language(chan)
ast_channel_language
ast_channel_language
chan
chan
ast_debug(3, "Played beep, result '%d'\n", res);
ast_debug(3, "Played beep, result '%d'\n", res)
ast_debug
ast_debug
3
"Played beep, result '%d'\n"
res
res
if (!res) {		res = ast_waitstream(chan, "");		ast_debug(3, "Waited for stream, result '%d'\n", res);	}
!res
res
res
{		res = ast_waitstream(chan, "");		ast_debug(3, "Waited for stream, result '%d'\n", res);	}
res = ast_waitstream(chan, "");
res = ast_waitstream(chan, "")
res
res
ast_waitstream(chan, "")
ast_waitstream
ast_waitstream
chan
chan
""
ast_debug(3, "Waited for stream, result '%d'\n", res);
ast_debug(3, "Waited for stream, result '%d'\n", res)
ast_debug
ast_debug
3
"Waited for stream, result '%d'\n"
res
res
ast_mutex_lock(&p->lock);
ast_mutex_lock(&p->lock)
ast_mutex_lock
ast_mutex_lock
&p->lock
p->lock
p
p
lock
if (!p->chan) {		/* chan went away while we were streaming, this shouldn't be possible */		res = -1;	}
!p->chan
p->chan
p
p
chan
{		/* chan went away while we were streaming, this shouldn't be possible */		res = -1;	}
res = -1;
res = -1
res
res
-1
1
if (!res) {		struct ast_format tmpfmt;		res = ast_set_read_format_from_cap(p->chan, ast_channel_nativeformats(p->chan));		ast_debug(3, "Set read format, result '%d'\n", res);		if (res)			ast_log(LOG_WARNING, "Unable to set read format to %s\n", ast_getformatname(&tmpfmt));	} else {		/* Agent hung-up */		p->chan = NULL;		ast_devstate_changed(AST_DEVICE_UNAVAILABLE, "Agent/%s", p->agent);	}
!res
res
res
{		struct ast_format tmpfmt;		res = ast_set_read_format_from_cap(p->chan, ast_channel_nativeformats(p->chan));		ast_debug(3, "Set read format, result '%d'\n", res);		if (res)			ast_log(LOG_WARNING, "Unable to set read format to %s\n", ast_getformatname(&tmpfmt));	}
struct ast_format tmpfmt;
struct ast_format tmpfmt;
struct ast_format
ast_format
tmpfmt
tmpfmt
res = ast_set_read_format_from_cap(p->chan, ast_channel_nativeformats(p->chan));
res = ast_set_read_format_from_cap(p->chan, ast_channel_nativeformats(p->chan))
res
res
ast_set_read_format_from_cap(p->chan, ast_channel_nativeformats(p->chan))
ast_set_read_format_from_cap
ast_set_read_format_from_cap
p->chan
p
p
chan
ast_channel_nativeformats(p->chan)
ast_channel_nativeformats
ast_channel_nativeformats
p->chan
p
p
chan
ast_debug(3, "Set read format, result '%d'\n", res);
ast_debug(3, "Set read format, result '%d'\n", res)
ast_debug
ast_debug
3
"Set read format, result '%d'\n"
res
res
if (res)			ast_log(LOG_WARNING, "Unable to set read format to %s\n", ast_getformatname(&tmpfmt));
res
res
ast_log(LOG_WARNING, "Unable to set read format to %s\n", ast_getformatname(&tmpfmt));
ast_log(LOG_WARNING, "Unable to set read format to %s\n", ast_getformatname(&tmpfmt))
ast_log
ast_log
LOG_WARNING
LOG_WARNING
"Unable to set read format to %s\n"
ast_getformatname(&tmpfmt)
ast_getformatname
ast_getformatname
&tmpfmt
tmpfmt
tmpfmt
{		/* Agent hung-up */		p->chan = NULL;		ast_devstate_changed(AST_DEVICE_UNAVAILABLE, "Agent/%s", p->agent);	}
p->chan = NULL;
p->chan = NULL
p->chan
p
p
chan
NULL
NULL
ast_devstate_changed(AST_DEVICE_UNAVAILABLE, "Agent/%s", p->agent);
ast_devstate_changed(AST_DEVICE_UNAVAILABLE, "Agent/%s", p->agent)
ast_devstate_changed
ast_devstate_changed
AST_DEVICE_UNAVAILABLE
AST_DEVICE_UNAVAILABLE
"Agent/%s"
p->agent
p
p
agent
if (!res) {		struct ast_format tmpfmt;		res = ast_set_write_format_from_cap(p->chan, ast_channel_nativeformats(p->chan));		ast_debug(3, "Set write format, result '%d'\n", res);		if (res)			ast_log(LOG_WARNING, "Unable to set write format to %s\n", ast_getformatname(&tmpfmt));	}
!res
res
res
{		struct ast_format tmpfmt;		res = ast_set_write_format_from_cap(p->chan, ast_channel_nativeformats(p->chan));		ast_debug(3, "Set write format, result '%d'\n", res);		if (res)			ast_log(LOG_WARNING, "Unable to set write format to %s\n", ast_getformatname(&tmpfmt));	}
struct ast_format tmpfmt;
struct ast_format tmpfmt;
struct ast_format
ast_format
tmpfmt
tmpfmt
res = ast_set_write_format_from_cap(p->chan, ast_channel_nativeformats(p->chan));
res = ast_set_write_format_from_cap(p->chan, ast_channel_nativeformats(p->chan))
res
res
ast_set_write_format_from_cap(p->chan, ast_channel_nativeformats(p->chan))
ast_set_write_format_from_cap
ast_set_write_format_from_cap
p->chan
p
p
chan
ast_channel_nativeformats(p->chan)
ast_channel_nativeformats
ast_channel_nativeformats
p->chan
p
p
chan
ast_debug(3, "Set write format, result '%d'\n", res);
ast_debug(3, "Set write format, result '%d'\n", res)
ast_debug
ast_debug
3
"Set write format, result '%d'\n"
res
res
if (res)			ast_log(LOG_WARNING, "Unable to set write format to %s\n", ast_getformatname(&tmpfmt));
res
res
ast_log(LOG_WARNING, "Unable to set write format to %s\n", ast_getformatname(&tmpfmt));
ast_log(LOG_WARNING, "Unable to set write format to %s\n", ast_getformatname(&tmpfmt))
ast_log
ast_log
LOG_WARNING
LOG_WARNING
"Unable to set write format to %s\n"
ast_getformatname(&tmpfmt)
ast_getformatname
ast_getformatname
&tmpfmt
tmpfmt
tmpfmt
if(!res) {		/* Call is immediately up, or might need ack */		if (p->ackcall) {			newstate = AST_STATE_RINGING;		} else {			newstate = AST_STATE_UP;			if (recordagentcalls)				agent_start_monitoring(ast, 0);			p->acknowledged = 1;		}		res = 0;	}
!res
res
res
{		/* Call is immediately up, or might need ack */		if (p->ackcall) {			newstate = AST_STATE_RINGING;		} else {			newstate = AST_STATE_UP;			if (recordagentcalls)				agent_start_monitoring(ast, 0);			p->acknowledged = 1;		}		res = 0;	}
if (p->ackcall) {			newstate = AST_STATE_RINGING;		} else {			newstate = AST_STATE_UP;			if (recordagentcalls)				agent_start_monitoring(ast, 0);			p->acknowledged = 1;		}
p->ackcall
p
p
ackcall
{			newstate = AST_STATE_RINGING;		}
newstate = AST_STATE_RINGING;
newstate = AST_STATE_RINGING
newstate
newstate
AST_STATE_RINGING
AST_STATE_RINGING
{			newstate = AST_STATE_UP;			if (recordagentcalls)				agent_start_monitoring(ast, 0);			p->acknowledged = 1;		}
newstate = AST_STATE_UP;
newstate = AST_STATE_UP
newstate
newstate
AST_STATE_UP
AST_STATE_UP
if (recordagentcalls)				agent_start_monitoring(ast, 0);
recordagentcalls
recordagentcalls
agent_start_monitoring(ast, 0);
agent_start_monitoring(ast, 0)
agent_start_monitoring
agent_start_monitoring
ast
ast
0
p->acknowledged = 1;
p->acknowledged = 1
p->acknowledged
p
p
acknowledged
1
res = 0;
res = 0
res
res
0
CLEANUP(ast, p);
CLEANUP(ast, p)
CLEANUP
CLEANUP
ast
ast
p
p
ast_mutex_unlock(&p->lock);
ast_mutex_unlock(&p->lock)
ast_mutex_unlock
ast_mutex_unlock
&p->lock
p->lock
p
p
lock
if (newstate)		ast_setstate(ast, newstate);
newstate
newstate
ast_setstate(ast, newstate);
ast_setstate(ast, newstate)
ast_setstate
ast_setstate
ast
ast
newstate
newstate
return res;
res
res
-----joern-----
(167,129,0)
(200,154,0)
(10,42,0)
(80,18,0)
(13,122,0)
(29,11,0)
(25,88,0)
(200,180,0)
(136,12,0)
(214,138,0)
(201,12,0)
(109,14,0)
(187,14,0)
(206,84,0)
(176,155,0)
(83,7,0)
(144,204,0)
(229,59,0)
(152,79,0)
(5,202,0)
(119,165,0)
(113,164,0)
(26,28,0)
(57,234,0)
(59,193,0)
(190,43,0)
(101,30,0)
(87,59,0)
(217,82,0)
(116,127,0)
(38,203,0)
(148,216,0)
(28,26,0)
(160,37,0)
(120,164,0)
(50,26,0)
(201,54,0)
(208,108,0)
(202,43,0)
(92,12,0)
(64,30,0)
(128,146,0)
(183,225,0)
(100,188,0)
(7,107,0)
(172,107,0)
(194,165,0)
(177,231,0)
(212,62,0)
(135,107,0)
(55,119,0)
(136,7,0)
(111,92,0)
(60,104,0)
(203,123,0)
(175,157,0)
(153,100,0)
(155,65,0)
(58,129,0)
(150,154,0)
(33,17,0)
(14,7,0)
(237,31,0)
(128,189,0)
(77,17,0)
(43,107,0)
(96,107,0)
(164,113,0)
(132,194,0)
(129,7,0)
(51,230,0)
(18,186,0)
(199,164,0)
(157,107,0)
(220,30,0)
(202,5,0)
(23,55,0)
(2,106,0)
(191,70,0)
(200,42,0)
(200,12,0)
(156,189,0)
(127,34,0)
(129,84,0)
(99,151,0)
(146,19,0)
(55,147,0)
(199,43,0)
(88,118,0)
(236,203,0)
(115,136,0)
(97,104,0)
(20,231,0)
(27,154,0)
(226,54,0)
(55,7,0)
(130,231,0)
(143,17,0)
(196,107,0)
(117,37,0)
(110,25,0)
(88,25,0)
(35,144,0)
(5,31,0)
(70,54,0)
(106,175,0)
(230,7,0)
(141,199,0)
(131,55,0)
(223,34,0)
(22,52,0)
(143,77,0)
(84,206,0)
(234,7,0)
(205,7,0)
(37,160,0)
(211,107,0)
(222,201,0)
(9,107,0)
(82,194,0)
(102,225,0)
(43,202,0)
(216,107,0)
(35,164,0)
(113,31,0)
(32,19,0)
(103,219,0)
(71,230,0)
(47,123,0)
(7,136,0)
(52,151,0)
(41,107,0)
(184,70,0)
(126,43,0)
(221,210,0)
(108,206,0)
(89,130,0)
(237,7,0)
(11,144,0)
(74,113,0)
(198,13,0)
(199,34,0)
(63,14,0)
(19,146,0)
(185,203,0)
(94,65,0)
(231,7,0)
(183,226,0)
(84,129,0)
(46,200,0)
(45,43,0)
(233,160,0)
(212,11,0)
(82,7,0)
(11,34,0)
(116,7,0)
(116,119,0)
(68,107,0)
(212,220,0)
(142,194,0)
(76,216,0)
(122,188,0)
(36,143,0)
(53,77,0)
(157,175,0)
(11,43,0)
(225,183,0)
(37,7,0)
(228,116,0)
(91,22,0)
(45,144,0)
(11,155,0)
(100,7,0)
(56,79,0)
(188,122,0)
(62,54,0)
(105,42,0)
(203,34,0)
(224,100,0)
(154,186,0)
(39,210,0)
(35,43,0)
(42,107,0)
(232,237,0)
(178,107,0)
(49,113,0)
(194,82,0)
(44,82,0)
(160,233,0)
(218,108,0)
(1,180,0)
(16,126,0)
(138,144,0)
(26,7,0)
(124,92,0)
(11,164,0)
(69,205,0)
(139,151,0)
(79,107,0)
(169,13,0)
(61,152,0)
(202,31,0)
(161,237,0)
(9,28,0)
(112,202,0)
(199,77,0)
(86,64,0)
(21,107,0)
(210,18,0)
(205,119,0)
(210,7,0)
(127,116,0)
(13,7,0)
(213,62,0)
(130,89,0)
(71,178,0)
(15,59,0)
(207,155,0)
(24,5,0)
(197,205,0)
(145,233,0)
(179,107,0)
(73,156,0)
(140,45,0)
(235,118,0)
(8,119,0)
(6,188,0)
(114,202,0)
(199,144,0)
(108,7,0)
(216,12,0)
(180,0,0)
(133,116,0)
(219,7,0)
(188,107,0)
(98,106,0)
(104,7,0)
(219,103,0)
(11,107,0)
(84,77,0)
(225,7,0)
(34,123,0)
(226,183,0)
(31,237,0)
(146,128,0)
(48,179,0)
(159,107,0)
(181,107,0)
(106,7,0)
(125,233,0)
(233,107,0)
(163,230,0)
(121,144,0)
(52,22,0)
(209,152,0)
(78,143,0)
(178,71,0)
(206,108,0)
(59,164,0)
(127,147,0)
(182,179,0)
(14,63,0)
(62,152,0)
(89,107,0)
(152,7,0)
(158,107,0)
(164,193,0)
(173,234,0)
(166,37,0)
(162,143,0)
(170,26,0)
(192,201,0)
(195,19,0)
(40,220,0)
(45,77,0)
(4,180,0)
(179,43,0)
(168,107,0)
(30,64,0)
(11,77,0)
(215,219,0)
(122,13,0)
(45,164,0)
(149,31,0)
(28,9,0)
(220,189,0)
(31,107,0)
(95,35,0)
(75,219,0)
(147,127,0)
(93,188,0)
(147,55,0)
(118,88,0)
(134,200,0)
(90,225,0)
(144,138,0)
(77,84,0)
(34,127,0)
(66,17,0)
(231,130,0)
(72,186,0)
(230,71,0)
(188,100,0)
(67,156,0)
(3,118,0)
(171,179,0)
(19,7,0)
(151,52,0)
(175,106,0)
(30,107,0)
(85,123,0)
(216,7,0)
(104,60,1)
(140,194,1)
(219,215,1)
(100,153,1)
(124,111,1)
(198,169,1)
(76,155,1)
(212,220,1)
(201,192,1)
(106,7,1)
(100,7,1)
(120,126,1)
(190,9,1)
(174,154,1)
(45,164,1)
(234,7,1)
(4,104,1)
(217,44,1)
(166,145,1)
(7,136,1)
(132,142,1)
(230,7,1)
(176,207,1)
(213,201,1)
(84,129,1)
(70,184,1)
(126,16,1)
(188,122,1)
(179,171,1)
(127,147,1)
(183,225,1)
(103,219,1)
(199,144,1)
(237,161,1)
(30,64,1)
(61,209,1)
(40,128,1)
(51,216,1)
(116,7,1)
(182,48,1)
(26,170,1)
(148,76,1)
(95,103,1)
(63,14,1)
(203,34,1)
(62,152,1)
(35,95,1)
(141,118,1)
(225,102,1)
(221,174,1)
(118,88,1)
(199,77,1)
(222,226,1)
(175,106,1)
(98,59,1)
(180,1,1)
(200,42,1)
(237,7,1)
(191,234,1)
(234,173,1)
(98,126,1)
(90,70,1)
(137,203,1)
(86,101,1)
(197,69,1)
(146,19,1)
(77,84,1)
(199,141,1)
(138,214,1)
(92,124,1)
(62,213,1)
(46,227,1)
(143,162,1)
(129,7,1)
(210,39,1)
(44,132,1)
(75,157,1)
(163,51,1)
(157,175,1)
(199,34,1)
(202,31,1)
(10,105,1)
(11,34,1)
(35,164,1)
(219,7,1)
(22,91,1)
(106,2,1)
(128,146,1)
(194,82,1)
(11,77,1)
(127,116,1)
(18,80,1)
(131,116,1)
(229,15,1)
(56,152,1)
(117,166,1)
(20,42,1)
(19,7,1)
(153,224,1)
(215,75,1)
(125,188,1)
(31,237,1)
(71,230,1)
(109,234,1)
(152,7,1)
(121,103,1)
(154,150,1)
(177,20,1)
(9,28,1)
(3,235,1)
(152,61,1)
(11,155,1)
(32,195,1)
(19,32,1)
(170,50,1)
(150,27,1)
(160,37,1)
(216,7,1)
(13,198,1)
(220,40,1)
(142,119,1)
(207,180,1)
(115,83,1)
(45,144,1)
(55,119,1)
(136,115,1)
(42,10,1)
(50,31,1)
(29,200,1)
(200,154,1)
(14,187,1)
(113,49,1)
(8,205,1)
(43,202,1)
(80,210,1)
(225,7,1)
(216,12,1)
(25,110,1)
(82,7,1)
(223,45,1)
(104,7,1)
(29,227,1)
(161,232,1)
(48,43,1)
(201,12,1)
(164,113,1)
(111,174,1)
(221,92,1)
(64,86,1)
(184,191,1)
(67,63,1)
(52,22,1)
(49,74,1)
(208,218,1)
(167,58,1)
(143,77,1)
(45,140,1)
(88,25,1)
(69,35,1)
(116,119,1)
(81,143,1)
(87,164,1)
(45,43,1)
(78,77,1)
(232,149,1)
(216,148,1)
(147,55,1)
(99,139,1)
(23,131,1)
(200,12,1)
(116,133,1)
(171,182,1)
(39,221,1)
(133,228,1)
(136,12,1)
(95,144,1)
(24,112,1)
(200,134,1)
(113,31,1)
(185,38,1)
(73,67,1)
(228,223,1)
(101,7,1)
(79,56,1)
(155,176,1)
(231,177,1)
(59,164,1)
(114,190,1)
(236,34,1)
(28,26,1)
(214,121,1)
(59,229,1)
(55,7,1)
(97,199,1)
(14,7,1)
(149,233,1)
(188,100,1)
(178,71,1)
(179,43,1)
(16,179,1)
(126,43,1)
(6,93,1)
(34,127,1)
(218,129,1)
(110,3,1)
(11,43,1)
(89,130,1)
(230,163,1)
(141,137,1)
(105,30,1)
(5,31,1)
(187,109,1)
(192,222,1)
(207,18,1)
(91,99,1)
(227,178,1)
(15,87,1)
(231,7,1)
(37,117,1)
(11,164,1)
(37,7,1)
(1,4,1)
(102,90,1)
(26,7,1)
(129,167,1)
(13,7,1)
(226,183,1)
(235,137,1)
(205,7,1)
(220,30,1)
(210,7,1)
(60,97,1)
(122,13,1)
(2,98,1)
(140,151,1)
(92,12,1)
(36,78,1)
(93,63,1)
(140,81,1)
(84,206,1)
(82,217,1)
(45,77,1)
(205,197,1)
(139,81,1)
(57,79,1)
(202,5,1)
(108,208,1)
(112,114,1)
(58,53,1)
(11,144,1)
(145,125,1)
(162,36,1)
(199,164,1)
(195,156,1)
(53,35,1)
(55,23,1)
(119,8,1)
(199,43,1)
(11,29,1)
(233,160,1)
(169,100,1)
(212,11,1)
(108,7,1)
(5,24,1)
(203,185,1)
(212,62,1)
(134,46,1)
(209,89,1)
(206,108,1)
(156,73,1)
(144,138,1)
(173,57,1)
(141,45,1)
(151,52,1)
(35,43,1)
(224,6,1)
(35,144,1)
(76,199,1)
(27,104,1)
(130,231,1)
(38,236,1)
(74,120,1)
(200,180,1)
(48,63,2)
(75,63,2)
(70,234,2)
(218,35,2)
(170,63,2)
(129,35,2)
(213,234,2)
(53,35,2)
(82,35,2)
(90,234,2)
(37,63,2)
(200,12,2)
(194,35,2)
(139,81,2)
(118,137,2)
(45,144,2)
(183,225,2)
(15,126,2)
(216,7,2)
(76,63,2)
(164,126,2)
(219,63,2)
(5,31,2)
(226,183,2)
(161,63,2)
(13,7,2)
(121,103,2)
(113,126,2)
(200,227,2)
(25,137,2)
(129,7,2)
(200,180,2)
(221,104,2)
(216,12,2)
(49,126,2)
(34,127,2)
(210,104,2)
(164,113,2)
(200,154,2)
(92,12,2)
(8,35,2)
(62,234,2)
(51,63,2)
(126,63,2)
(152,7,2)
(131,45,2)
(29,63,2)
(71,230,2)
(166,63,2)
(119,35,2)
(112,63,2)
(134,227,2)
(108,7,2)
(11,43,2)
(116,119,2)
(124,174,2)
(153,63,2)
(60,199,2)
(80,104,2)
(45,77,2)
(232,63,2)
(157,63,2)
(81,35,2)
(145,63,2)
(26,63,2)
(222,234,2)
(23,45,2)
(143,77,2)
(55,7,2)
(174,104,2)
(39,104,2)
(141,63,2)
(137,45,2)
(217,35,2)
(178,63,2)
(55,119,2)
(28,26,2)
(195,63,2)
(230,7,2)
(146,19,2)
(169,63,2)
(233,160,2)
(74,126,2)
(87,126,2)
(116,45,2)
(212,11,2)
(122,63,2)
(206,108,2)
(88,25,2)
(14,234,2)
(100,63,2)
(194,82,2)
(183,234,2)
(14,7,2)
(104,199,2)
(154,104,2)
(4,104,2)
(110,137,2)
(138,103,2)
(190,63,2)
(19,7,2)
(78,35,2)
(220,63,2)
(35,144,2)
(127,147,2)
(59,164,2)
(202,63,2)
(100,7,2)
(237,63,2)
(188,63,2)
(192,234,2)
(167,35,2)
(88,137,2)
(133,45,2)
(127,45,2)
(45,43,2)
(199,77,2)
(199,43,2)
(130,231,2)
(227,63,2)
(89,130,2)
(77,84,2)
(155,199,2)
(215,63,2)
(52,22,2)
(122,13,2)
(1,104,2)
(233,63,2)
(58,35,2)
(31,237,2)
(191,234,2)
(197,35,2)
(212,220,2)
(179,43,2)
(146,63,2)
(32,63,2)
(73,63,2)
(142,35,2)
(31,63,2)
(98,63,2)
(188,100,2)
(187,234,2)
(180,104,2)
(11,63,2)
(40,63,2)
(210,7,2)
(103,219,2)
(102,234,2)
(5,63,2)
(147,45,2)
(224,63,2)
(9,63,2)
(184,234,2)
(151,52,2)
(67,63,2)
(148,63,2)
(84,129,2)
(7,136,2)
(162,35,2)
(150,104,2)
(93,63,2)
(63,234,2)
(59,126,2)
(71,63,2)
(225,7,2)
(185,45,2)
(69,35,2)
(205,35,2)
(234,7,2)
(114,63,2)
(216,63,2)
(199,63,2)
(97,199,2)
(35,164,2)
(11,155,2)
(230,63,2)
(103,63,2)
(3,137,2)
(202,31,2)
(179,63,2)
(106,7,2)
(26,7,2)
(19,63,2)
(220,30,2)
(52,81,2)
(160,63,2)
(205,7,2)
(128,146,2)
(120,126,2)
(198,63,2)
(206,35,2)
(199,144,2)
(91,81,2)
(156,63,2)
(63,14,2)
(30,64,2)
(225,234,2)
(203,45,2)
(27,104,2)
(201,12,2)
(151,81,2)
(188,122,2)
(144,103,2)
(207,199,2)
(140,63,2)
(62,152,2)
(175,63,2)
(223,45,2)
(113,31,2)
(106,63,2)
(236,45,2)
(214,103,2)
(11,164,2)
(46,227,2)
(235,137,2)
(36,35,2)
(28,63,2)
(199,34,2)
(127,116,2)
(160,37,2)
(108,35,2)
(77,35,2)
(212,62,2)
(9,28,2)
(143,35,2)
(11,144,2)
(16,63,2)
(2,63,2)
(34,45,2)
(144,138,2)
(37,7,2)
(203,34,2)
(109,234,2)
(125,63,2)
(226,234,2)
(128,63,2)
(157,175,2)
(82,7,2)
(132,35,2)
(22,81,2)
(38,45,2)
(99,81,2)
(24,63,2)
(171,63,2)
(219,7,2)
(182,63,2)
(35,63,2)
(126,43,2)
(117,63,2)
(95,63,2)
(45,164,2)
(104,7,2)
(13,63,2)
(178,71,2)
(92,174,2)
(199,164,2)
(118,88,2)
(11,77,2)
(35,43,2)
(111,174,2)
(136,12,2)
(18,104,2)
(84,35,2)
(11,34,2)
(43,202,2)
(231,7,2)
(84,206,2)
(116,7,2)
(200,42,2)
(175,106,2)
(44,35,2)
(228,45,2)
(147,55,2)
(45,63,2)
(202,5,2)
(176,199,2)
(163,63,2)
(6,63,2)
(229,126,2)
(55,45,2)
(237,7,2)
(201,234,2)
(43,63,2)
(149,63,2)
(208,35,2)
(50,63,2)
-----------------------------------
(0,)
(1,AST_STATE_RINGING)
(2,lock)
(3,"Unable to set write format to %s\\n")
(4,newstate)
(5,ast_channel_language(chan)
(6,"agent_call, call to agent \'%s\' call on \'%s\'\\n")
(7,*p = ast_channel_tech_pvt(ast)
(8,NULL)
(9,ast_mutex_unlock(&p->lock)
(10,0)
(11,return res;)
(12,struct ast_channel *ast)
(13,p->chan)
(14,p->chan)
(15,"Waited for stream, result \'%d\'\\n")
(16,res)
(17,)
(18,p->acknowledged = 1)
(19,p->lock)
(20,p)
(21,if(!res)
(22,&tmpfmt)
(23,chan)
(24,chan)
(25,&tmpfmt)
(26,p->lock)
(27,newstate)
(28,&p->lock)
(29,res)
(30,res = -1)
(31,chan = p->chan)
(32,lock)
(33,if (res)
(34,res = ast_set_write_format_from_cap(p->chan, ast_channel_nativeformats(p->chan)
(35,!res)
(36,"Set read format, result \'%d\'\\n")
(37,p->chan)
(38,"Set write format, result \'%d\'\\n")
(39,acknowledged)
(40,res)
(41,if (newstate)
(42,newstate=0)
(43,res = ast_streamfile(chan, beep, ast_channel_language(chan)
(44,p)
(45,!res)
(46,ast)
(47,if (res)
(48,3)
(49,"")
(50,p)
(51,p)
(52,ast_getformatname(&tmpfmt)
(53,res)
(54,)
(55,p->chan)
(56,0)
(57,p)
(58,p)
(59,ast_debug(3, "Waited for stream, result \'%d\'\\n", res)
(60,ackcall)
(61,acknowledged)
(62,return 0;)
(63,!p->chan)
(64,-1)
(65,)
(66,tmpfmt)
(67,LOG_DEBUG)
(68,if (!res)
(69,p)
(70,ast_log(LOG_DEBUG, "Pretending to dial on pending agent\\n")
(71,&p->lock)
(72,if (recordagentcalls)
(73,"Agent disconnected while we were connecting the call\\n")
(74,chan)
(75,p)
(76,ast)
(77,res = ast_set_read_format_from_cap(p->chan, ast_channel_nativeformats(p->chan)
(78,3)
(79,p->acknowledged = 0)
(80,1)
(81,res)
(82,p->agent)
(83,p)
(84,ast_set_read_format_from_cap(p->chan, ast_channel_nativeformats(p->chan)
(85,tmpfmt)
(86,1)
(87,3)
(88,ast_getformatname(&tmpfmt)
(89,ast_mutex_lock(&p->lock)
(90,p)
(91,tmpfmt)
(92,agent_start_monitoring(ast, 0)
(93,3)
(94,if (p->ackcall)
(95,res)
(96,newstate)
(97,p)
(98,p)
(99,"Unable to set read format to %s\\n")
(100,p->agent)
(101,res)
(102,lock)
(103,!p->chan)
(104,p->ackcall)
(105,newstate)
(106,p->lock)
(107,)
(108,p->chan)
(109,p)
(110,tmpfmt)
(111,ast)
(112,beep)
(113,ast_waitstream(chan, "")
(114,chan)
(115,ast)
(116,p->chan)
(117,chan)
(118,ast_log(LOG_WARNING, "Unable to set write format to %s\\n", ast_getformatname(&tmpfmt)
(119,p->chan = NULL)
(120,res)
(121,res)
(122,ast_channel_name(p->chan)
(123,)
(124,0)
(125,3)
(126,!res)
(127,ast_set_write_format_from_cap(p->chan, ast_channel_nativeformats(p->chan)
(128,ast_mutex_unlock(&p->lock)
(129,p->chan)
(130,&p->lock)
(131,p)
(132,"Agent/%s")
(133,chan)
(134,newstate)
(135,if (!p->chan)
(136,ast_channel_tech_pvt(ast)
(137,res)
(138,-1)
(139,LOG_WARNING)
(140,res)
(141,res)
(142,AST_DEVICE_UNAVAILABLE)
(143,ast_debug(3, "Set read format, result \'%d\'\\n", res)
(144,res = -1)
(145,"Playing beep, lang \'%s\'\\n")
(146,&p->lock)
(147,ast_channel_nativeformats(p->chan)
(148,p)
(149,chan)
(150,AST_STATE_UP)
(151,ast_log(LOG_WARNING, "Unable to set read format to %s\\n", ast_getformatname(&tmpfmt)
(152,p->acknowledged)
(153,agent)
(154,newstate = AST_STATE_UP)
(155,res = 0)
(156,ast_log(LOG_DEBUG, "Agent disconnected while we were connecting the call\\n")
(157,ast_mutex_lock(&p->lock)
(158,chan)
(159,p)
(160,ast_channel_language(p->chan)
(161,chan)
(162,res)
(163,lock)
(164,res = ast_waitstream(chan, "")
(165,)
(166,p)
(167,chan)
(168,if (!res)
(169,p)
(170,lock)
(171,res)
(172,if (!p->chan)
(173,pending)
(174,recordagentcalls)
(175,&p->lock)
(176,0)
(177,lock)
(178,ast_mutex_unlock(&p->lock)
(179,ast_debug(3, "Played beep, result \'%d\'\\n", res)
(180,newstate = AST_STATE_RINGING)
(181,if (!res)
(182,"Played beep, result \'%d\'\\n")
(183,&p->lock)
(184,"Pretending to dial on pending agent\\n")
(185,res)
(186,)
(187,chan)
(188,ast_verb(3, "agent_call, call to agent \'%s\' call on \'%s\'\\n", p->agent, ast_channel_name(p->chan)
(189,)
(190,res)
(191,LOG_DEBUG)
(192,AST_STATE_DIALING)
(193,)
(194,ast_devstate_changed(AST_DEVICE_UNAVAILABLE, "Agent/%s", p->agent)
(195,p)
(196,res)
(197,chan)
(198,chan)
(199,!res)
(200,ast_setstate(ast, newstate)
(201,ast_setstate(ast, AST_STATE_DIALING)
(202,ast_streamfile(chan, beep, ast_channel_language(chan)
(203,ast_debug(3, "Set write format, result \'%d\'\\n", res)
(204,)
(205,p->chan)
(206,ast_channel_nativeformats(p->chan)
(207,res)
(208,chan)
(209,p)
(210,p->acknowledged)
(211,if (p->pending)
(212,RET)
(213,0)
(214,1)
(215,chan)
(216,CLEANUP(ast, p)
(217,agent)
(218,p)
(219,p->chan)
(220,return res;)
(221,p)
(222,ast)
(223,res)
(224,p)
(225,p->lock)
(226,ast_mutex_unlock(&p->lock)
(227,newstate)
(228,p)
(229,res)
(230,p->lock)
(231,p->lock)
(232,p)
(233,ast_debug(3, "Playing beep, lang \'%s\'\\n", ast_channel_language(p->chan)
(234,p->pending)
(235,LOG_WARNING)
(236,3)
(237,p->chan)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^